<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cron Agent 控制面板</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <circle cx="16" cy="16" r="14" stroke="currentColor" stroke-width="2"/>
                    <path d="M16 8v8l5 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>Cron Agent</span>
            </div>
            <nav class="nav-menu">
                <button class="nav-item active" data-view="status"><span>服务状态</span></button>
                <button class="nav-item" data-view="task-settings"><span>任务配置</span></button>
                <button class="nav-item" data-view="journal"><span>日志汇总</span></button>
                <button class="nav-item" data-view="logs"><span>活动日志</span></button>
                <button class="nav-item" data-view="messages"><span>消息</span></button>
            </nav>
            <div class="sidebar-footer"><div class="version">v2.0.0</div></div>
        </aside>

        <main class="main-content">
            <div class="view active" id="view-status">
                <header class="view-header">
                    <h1>服务状态</h1>
                    <p class="subtitle">查看和管理定时任务服务</p>
                </header>

                <div class="status-cards">
                    <div class="status-card status-card-wide">
                        <div class="status-indicator" id="capture-status-indicator">
                            <div class="status-dot"></div>
                            <span>检查中...</span>
                        </div>
                        <div class="status-details">
                            <h3>截图服务 (Tmux)</h3>
                            <p id="capture-status-text">正在获取状态...</p>
                        </div>
                    </div>

                    <div class="status-card status-card-wide">
                        <div class="status-indicator" id="summarizer-status-indicator">
                            <div class="status-dot"></div>
                            <span>检查中...</span>
                        </div>
                        <div class="status-details">
                            <h3>汇总服务 (Cron)</h3>
                            <p id="summarizer-status-text">正在获取状态...</p>
                        </div>
                    </div>

                    <div class="status-card info">
                        <div class="card-content">
                            <h3>今日记录</h3>
                            <p id="today-records">-</p>
                        </div>
                    </div>
                </div>

                <div class="action-section">
                    <h2>服务任务</h2>
                    <div class="service-jobs" id="service-jobs"><div class="loading">加载中...</div></div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" id="btn-start-capture">启动/重启截图</button>
                    <button class="btn btn-danger" id="btn-stop-capture">停止截图</button>
                    <button class="btn btn-secondary" id="btn-start-summarizer">启动/重启汇总</button>
                    <button class="btn btn-danger-outline" id="btn-stop-summarizer">停止汇总</button>
                </div>
            </div>

            <div class="view" id="view-task-settings">
                <header class="view-header">
                    <h1>任务配置</h1>
                    <p class="subtitle">按任务编辑执行参数（无全局配置）</p>
                </header>

                <div class="config-sections">
                    <div class="config-section">
                        <h2>目标任务</h2>
                        <div class="config-grid">
                            <div class="config-item">
                                <label>Task ID</label>
                                <select id="settings-task-id"></select>
                            </div>
                            <div class="config-item">
                                <label>Mode</label>
                                <select id="settings-mode">
                                    <option value="agent">agent</option>
                                    <option value="llm">llm</option>
                                </select>
                            </div>
                            <div class="config-item">
                                <label>Run Backend</label>
                                <select id="settings-run-backend">
                                    <option value="tmux">tmux</option>
                                    <option value="cron">cron</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h2>调度配置</h2>
                        <div class="config-grid">
                            <div class="config-item"><label>Cron</label><input type="text" id="settings-cron" placeholder="0 5 * * *"></div>
                            <div class="config-item"><label>Interval Seconds</label><input type="number" id="settings-interval" min="1"></div>
                            <div class="config-item"><label>Timezone</label><input type="text" id="settings-timezone" placeholder="Asia/Shanghai"></div>
                            <div class="config-item"><label>Max Concurrency</label><input type="number" id="settings-max-concurrency" min="1"></div>
                            <div class="config-item"><label>Misfire Policy</label><select id="settings-misfire"><option value="run_once">run_once</option><option value="skip">skip</option></select></div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h2>输入与执行</h2>
                        <div class="config-grid">
                            <div class="config-item" style="grid-column: 1 / -1;"><label>Input Prompt</label><textarea id="settings-prompt" rows="7"></textarea></div>
                            <div class="config-item"><label>Timeout Seconds</label><input type="number" id="settings-timeout" min="1"></div>
                            <div class="config-item"><label>Working Directory</label><input type="text" id="settings-workdir" placeholder="."></div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h2>Agent 配置</h2>
                        <div class="config-grid">
                            <div class="config-item"><label>Provider</label><input type="text" id="settings-agent-provider" placeholder="codex"></div>
                            <div class="config-item"><label>Model</label><input type="text" id="settings-agent-model" placeholder="gpt-5-codex"></div>
                            <div class="config-item"><label>Sandbox</label><input type="text" id="settings-agent-sandbox" placeholder="workspace-write"></div>
                            <div class="config-item" style="grid-column: 1 / -1;"><label>System Prompt</label><textarea id="settings-agent-system" rows="5"></textarea></div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h2>LLM 配置</h2>
                        <div class="config-grid">
                            <div class="config-item"><label>Provider</label><input type="text" id="settings-llm-provider" placeholder="kimi_openai_compat"></div>
                            <div class="config-item"><label>Model</label><input type="text" id="settings-llm-model" placeholder="kimi-k2.5"></div>
                            <div class="config-item"><label>API Base</label><input type="text" id="settings-llm-base" placeholder="https://api.moonshot.cn/v1"></div>
                            <div class="config-item"><label>Auth Ref (明文或 env:)</label><input type="text" id="settings-llm-auth"></div>
                            <div class="config-item"><label>Temperature</label><input type="number" id="settings-llm-temp" step="0.1"></div>
                            <div class="config-item"><label>Max Tokens</label><input type="number" id="settings-llm-max-tokens" min="1"></div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h2>输出</h2>
                        <div class="config-grid">
                            <div class="config-item"><label>Output Sink</label><input type="text" id="settings-output-sink" placeholder="file"></div>
                            <div class="config-item"><label>Output Format</label><input type="text" id="settings-output-format" placeholder="text"></div>
                            <div class="config-item" style="grid-column: 1 / -1;"><label>Output Path Template</label><input type="text" id="settings-output-path"></div>
                        </div>
                    </div>

                    <div class="config-actions">
                        <button class="btn btn-primary" id="btn-save-task-settings">保存任务配置</button>
                    </div>
                </div>
            </div>

            <div class="view" id="view-journal">
                <header class="view-header"><h1>日志汇总</h1><p class="subtitle">查看日报、周报、月报和时段总结</p></header>
                <div class="journal-tabs">
                    <button class="journal-tab active" data-period="daily">日报</button>
                    <button class="journal-tab" data-period="weekly">周报</button>
                    <button class="journal-tab" data-period="monthly">月报</button>
                    <button class="journal-tab" data-period="period">时段</button>
                </div>
                <div class="journal-container">
                    <div class="journal-files" id="journal-files"></div>
                    <div class="journal-detail" id="journal-detail"></div>
                </div>
            </div>

            <div class="view" id="view-logs">
                <header class="view-header"><h1>活动日志</h1><p class="subtitle">查看截图分析的记录数据</p></header>
                <div class="logs-toolbar">
                    <select id="log-date"></select>
                    <button class="btn btn-secondary" id="btn-refresh-logs">刷新</button>
                </div>
                <div class="logs-list" id="logs-list"></div>
            </div>

            <div class="view" id="view-messages">
                <header class="view-header"><h1>消息</h1><p class="subtitle">查看消息通知记录</p></header>
                <div class="messages-toolbar">
                    <button class="btn btn-secondary" id="btn-refresh-messages">刷新</button>
                </div>
                <div class="messages-list" id="messages-list"></div>
            </div>
        </main>
    </div>

    <div id="toast" class="toast"></div>
    <script src="/static/app.js"></script>
</body>
</html>
