apiVersion: cron-agent/v1
kind: CronTask
metadata:
  id: capture-analyze
  name: Capture Analyze
  enabled: true
spec:
  mode: agent
  runBackend: tmux
  schedule:
    intervalSeconds: 900
    maxConcurrency: 1
    misfirePolicy: skip
  input:
    prompt: |
      Execute one capture-and-analyze cycle for this repository.
      Required outcome:
      1) Capture current screen(s) and analyze activities.
      2) Append normalized activity record into records/<today>.jsonl.
      3) Return a short Chinese summary of what was recorded.
  execution:
    timeoutSeconds: 240
    workingDirectory: "."
    retry:
      maxAttempts: 1
      backoffSeconds: 0
  modeConfig:
    agent:
      provider: codex_cli
      model: gpt-5-codex
      sandboxMode: workspace-write
      systemPrompt: |
        You are the cron task coding agent.
        Complete the capture/analyze/record workflow in this workspace.
        If environment permission is missing, fail explicitly with diagnostics.
  output:
    sink: file
    pathTemplate: artifacts/{task_id}/{run_id}/result.txt
    format: text
  logging:
    eventJsonlPath: logs/runs/{date}.jsonl
